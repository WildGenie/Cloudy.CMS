@using Poetry.UI.PortalSupport
@using Poetry.ComponentSupport
@using Poetry.ComponentSupport.DependencySupport
@using Poetry.UI.ScriptSupport
@using Poetry.UI.StyleSupport

@inject ITitleProvider TitleProvider
@inject IFaviconProvider FaviconProvider
@inject IComponentDependencySorter ComponentDependencySorter
@inject IComponentProvider ComponentProvider
@inject IScriptProvider ScriptProvider
@inject IStyleProvider StyleProvider
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>@TitleProvider.Title</title>

    <base href="@Context.Request.PathBase/">

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="icon" href="@FaviconProvider.Favicon">

    @foreach (var component in ComponentDependencySorter.Sort(ComponentProvider.GetAll()))
    {
        foreach (var script in ScriptProvider.GetAllFor(component))
        {
            <script type="module" src="@component.Id/@script.Path" crossorigin="use-credentials"></script>
        }
        foreach (var style in StyleProvider.GetAllFor(component))
        {
            <link rel="stylesheet" type="text/css" href="@component.Id/@style.Path" />
        }
    }
</head>
<body>
    <script type="module">
        import Portal from './Cloudy.CMS.Admin/Scripts/portal.js';
        new Portal();
    </script>
</body>
</html>